package edu.upenn.cis455.parser;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.io.StringReader;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;

import org.w3c.dom.Document;
import org.w3c.tidy.Tidy;
import org.xml.sax.InputSource;

public class DoMTreeBuilder {

	private String filecontent;
	private Document doc;
	private boolean ishtml;

	public DoMTreeBuilder(String filecontents, String url){
		this.filecontent = filecontents;
		if(url.toLowerCase().endsWith("xml")){
			ishtml = false;
		}
		else ishtml = true;
		buildTree();
	}

	private void buildTree(){
		try {
			if(!ishtml){
				DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
				DocumentBuilder builder = factory.newDocumentBuilder();
				InputSource is = new InputSource(new StringReader(filecontent));
				doc = builder.parse(is);
			}
			else{
				InputStream in = new ByteArrayInputStream(filecontent.getBytes());
				Tidy tidy = new Tidy();
				doc = tidy.parseDOM(in, null);
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public Document getDocumentNode(){
		return doc;
	}

}
